<Window x:Class="Mcp.Platform.Gui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MCP Platform GUI" Height="720" Width="1100" MinWidth="900" MinHeight="600">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="2*" />
        </Grid.RowDefinitions>

        <TextBlock Text="MCP Platform" FontSize="20" FontWeight="SemiBold" />

        <TabControl Grid.Row="1" Margin="0,12,0,12">
            <TabItem Header="Control">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Orientation="Vertical" Margin="0,4,0,8">
                        <GroupBox Header="General" Margin="0,0,0,10">
                            <Grid Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Dotnet path" VerticalAlignment="Center" />
                                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding DotnetPath, UpdateSourceTrigger=PropertyChanged}" />

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Work dir" VerticalAlignment="Center" Margin="0,8,0,0" />
                                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding WorkingDirectory, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="Gateway" Margin="0,0,0,10">
                            <Grid Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="180" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Status" VerticalAlignment="Center" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding GatewayStatusText}" VerticalAlignment="Center" />

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Project" VerticalAlignment="Center" Margin="0,8,0,0" />
                                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding GatewayProjectPath, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Args" VerticalAlignment="Center" Margin="0,8,0,0" />
                                <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding GatewayArgs, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                                <StackPanel Grid.Row="0" Grid.RowSpan="3" Grid.Column="2" Orientation="Vertical" HorizontalAlignment="Right">
                                    <Button Content="Start" Click="StartGateway_Click" IsEnabled="{Binding GatewayCanStart}" Width="140" Margin="0,0,0,8" />
                                    <Button Content="Stop" Click="StopGateway_Click" IsEnabled="{Binding GatewayCanStop}" Width="140" />
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <GroupBox Header="Frida worker">
                            <Grid Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="180" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Status" VerticalAlignment="Center" />
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding WorkerStatusText}" VerticalAlignment="Center" />

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Project" VerticalAlignment="Center" Margin="0,8,0,0" />
                                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding WorkerProjectPath, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Args" VerticalAlignment="Center" Margin="0,8,0,0" />
                                <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding WorkerArgs, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                                <StackPanel Grid.Row="0" Grid.RowSpan="3" Grid.Column="2" Orientation="Vertical" HorizontalAlignment="Right">
                                    <Button Content="Start" Click="StartWorker_Click" IsEnabled="{Binding WorkerCanStart}" Width="140" Margin="0,0,0,8" />
                                    <Button Content="Stop" Click="StopWorker_Click" IsEnabled="{Binding WorkerCanStop}" Width="140" />
                                </StackPanel>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Tools">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="Gateway url" VerticalAlignment="Center" />
                        <TextBox Grid.Column="1" Text="{Binding GatewayUrl, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,12,0" />

                        <TextBlock Grid.Column="2" Text="Auth token" VerticalAlignment="Center" />
                        <TextBox Grid.Column="3" Text="{Binding AuthToken, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,12,0" />

                        <Button Grid.Column="4" Content="Refresh" Click="RefreshTools_Click" Width="100" />
                    </Grid>

                    <Grid Grid.Row="1" Margin="0,12,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ListView Grid.Column="0" ItemsSource="{Binding Tools}" SelectedItem="{Binding SelectedTool, Mode=TwoWay}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="260" />
                                    <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" Width="520" />
                                </GridView>
                            </ListView.View>
                        </ListView>

                        <GroupBox Grid.Column="1" Header="Invoke" Margin="12,0,0,0">
                            <Grid Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Tool name" VerticalAlignment="Center" />
                                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding InvokeToolName, UpdateSourceTrigger=PropertyChanged}" />

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Description" VerticalAlignment="Center" Margin="0,8,0,0" />
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedToolDescription}" TextWrapping="Wrap" Margin="0,8,0,0" />

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Args json" VerticalAlignment="Center" Margin="0,8,0,0" />
                                <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding InvokeArgsJson, UpdateSourceTrigger=PropertyChanged}" AcceptsReturn="False" TextWrapping="NoWrap" Margin="0,8,0,0" />

                                <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                                    <Button Content="Invoke" Click="InvokeTool_Click" Width="100" Margin="0,0,8,0" />
                                    <Button Content="Clear" Click="ClearInvoke_Click" Width="100" />
                                </StackPanel>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Result" VerticalAlignment="Top" Margin="0,8,0,0" />
                                <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding InvokeResult, Mode=OneWay}" AcceptsReturn="True" IsReadOnly="True" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0" />
                            </Grid>
                        </GroupBox>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="SSE">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <GroupBox Header="SSE Control" Grid.Row="0">
                        <Grid Margin="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="140" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="180" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Status" VerticalAlignment="Center" />
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SseStatusText}" VerticalAlignment="Center" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="SSE url" VerticalAlignment="Center" Margin="0,8,0,0" />
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SseUrl, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Auth token" VerticalAlignment="Center" Margin="0,8,0,0" />
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SseToken, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                            <StackPanel Grid.Row="0" Grid.RowSpan="3" Grid.Column="2" Orientation="Vertical" HorizontalAlignment="Right">
                                <Button Content="Start" Click="StartSse_Click" IsEnabled="{Binding SseCanStart}" Width="140" Margin="0,0,0,8" />
                                <Button Content="Stop" Click="StopSse_Click" IsEnabled="{Binding SseCanStop}" Width="140" Margin="0,0,0,8" />
                                <Button Content="Clear" Click="ClearSse_Click" Width="140" />
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <GroupBox Header="Events" Grid.Row="1" Margin="0,10,0,0">
                        <TextBox x:Name="SseTextBox" AcceptsReturn="True" IsReadOnly="True" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" TextWrapping="NoWrap" FontFamily="Consolas" Margin="6" />
                    </GroupBox>
                </Grid>
            </TabItem>

            <TabItem Header="Ngrok">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <GroupBox Header="Ngrok Control" Grid.Row="0">
                        <Grid Margin="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="140" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="180" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Status" VerticalAlignment="Center" />
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding NgrokStatusText}" VerticalAlignment="Center" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Ngrok path" VerticalAlignment="Center" Margin="0,8,0,0" />
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding NgrokPath, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Port" VerticalAlignment="Center" Margin="0,8,0,0" />
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding NgrokPort, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Args" VerticalAlignment="Center" Margin="0,8,0,0" />
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding NgrokArgs, UpdateSourceTrigger=PropertyChanged}" Margin="0,8,0,0" />

                            <StackPanel Grid.Row="0" Grid.RowSpan="4" Grid.Column="2" Orientation="Vertical" HorizontalAlignment="Right">
                                <Button Content="Start" Click="StartNgrok_Click" IsEnabled="{Binding NgrokCanStart}" Width="140" Margin="0,0,0,8" />
                                <Button Content="Stop" Click="StopNgrok_Click" IsEnabled="{Binding NgrokCanStop}" Width="140" Margin="0,0,0,8" />
                                <Button Content="Refresh Urls" Click="RefreshNgrok_Click" Width="140" />
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <GroupBox Header="Tunnels" Grid.Row="1" Margin="0,10,0,0">
                        <ListView ItemsSource="{Binding NgrokTunnels}" Margin="6">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="180" />
                                    <GridViewColumn Header="Proto" DisplayMemberBinding="{Binding Proto}" Width="80" />
                                    <GridViewColumn Header="Public Url" DisplayMemberBinding="{Binding PublicUrl}" Width="420" />
                                    <GridViewColumn Header="Addr" DisplayMemberBinding="{Binding Addr}" Width="180" />
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </GroupBox>
                </Grid>
            </TabItem>
        </TabControl>

        <GroupBox Grid.Row="2" Header="Log">
            <DockPanel Margin="6">
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,6">
                    <Button Content="Clear" Click="ClearLog_Click" Width="80" />
                </StackPanel>
                <TextBox x:Name="LogTextBox" AcceptsReturn="True" IsReadOnly="True" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" TextWrapping="NoWrap" FontFamily="Consolas" />
            </DockPanel>
        </GroupBox>
    </Grid>
</Window>
